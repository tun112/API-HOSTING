<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Client</title>
    <style>
      /* Optional: Add some styling here */
    </style>
  </head>
  <body>
    <h1>Welcome to the API Client</h1>
    <input type="text" id="inputText" placeholder="Type your message here" />
    <button id="submitText">Submit</button>
    <p id="responseMessage"></p>

    <h2>Latest Submitted Texts:</h2>
    <ul id="textsList"></ul>

    <script>
      // Function to fetch and display texts
      async function fetchTexts() {
        try {
          const response = await fetch("/api/texts");
          if (!response.ok) throw new Error("Network response was not ok");
          const texts = await response.json();

          const textsList = document.getElementById("textsList");
          textsList.innerHTML = ""; // Clear the current list
          texts.forEach((text) => {
            const listItem = document.createElement("li");
            listItem.textContent = text; // Display each text in the list
            textsList.appendChild(listItem);
          });
        } catch (error) {
          console.error("Error fetching texts:", error);
        }
      }

      // Submit the text when the button is clicked
      document
        .getElementById("submitText")
        .addEventListener("click", async () => {
          const inputText = document.getElementById("inputText").value;
          try {
            const response = await fetch("/api/submit", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ text: inputText }), // Send the input text
            });
            if (!response.ok) throw new Error("Network response was not ok");
            const data = await response.json();
            document.getElementById("responseMessage").innerText = data.message;
            document.getElementById("inputText").value = ""; // Clear input field
          } catch (error) {
            console.error("Error submitting text:", error);
            document.getElementById("responseMessage").innerText =
              "Error submitting text";
          }
        });

      // Establish WebSocket connection
      const socket = new WebSocket(`ws://${window.location.host}`);

      // Listen for messages from the server
      socket.addEventListener("message", (event) => {
        const texts = JSON.parse(event.data);
        const textsList = document.getElementById("textsList");
        textsList.innerHTML = ""; // Clear the current list
        texts.forEach((text) => {
          const listItem = document.createElement("li");
          listItem.textContent = text; // Display each text in the list
          textsList.appendChild(listItem);
        });
      });

      // Call fetchTexts on page load to display existing texts
      window.onload = fetchTexts;
    </script>
  </body>
</html>
